# BlipShell Configuration
# This file is self-modifiable by the agent

models:
  reasoning: "glm-5:cloud"
  tool_calling: "glm-5:cloud"
  coding: "qwen3-coder:480b-cloud"
  summarization: "gemma3:4b"
  ranking: "gemma3:4b"
  embedding: "nomic-embed-text"

endpoints:
  - name: "local"
    url: "http://localhost:11434"
    roles: ["reasoning", "tool_calling", "coding", "embedding"]
    priority: 1
    max_concurrent: 2
    context_tokens: 131072  # 128K — GLM-5 and qwen3-coder support this
    enabled: true
  - name: "old-pc"
    url: "http://192.168.0.225:11434"
    roles: ["summarization", "ranking"]
    priority: 2    # higher = preferred for these roles
    max_concurrent: 2
    context_tokens: 131072  # gemma3:4b supports 128K
    enabled: true

memory:
  pools:
    core:
      percentage: 0.10
      max_tokens: 2048
      priority: 5
    active_session:
      percentage: 0.35
      max_tokens: null
      priority: 3
    recent_history:
      percentage: 0.15
      max_tokens: null
      priority: 4
    recall:
      percentage: 0.30
      max_tokens: 8192
      priority: 2
    buffer:
      percentage: 0.10
      max_tokens: null
      priority: 1

  total_context_tokens: 32768  # fallback default; overridden by endpoint context_tokens
  system_prompt_reserve: 2048
  overflow_batch_size: 4
  recall_search_limit: 20
  min_rank_threshold: 3
  importance_recency_bonus: 0.1
  importance_tag_bonus: 0.05
  similarity_threshold: 0.5
  importance_boost_weight: 0.2
  search_overfetch_multiplier: 2
  auto_prune_days: 90
  prune_max_importance: 0.3
  prune_max_rank: 2

session:
  max_messages_before_summary: 50
  summary_chunk_size: 20
  auto_save_interval: 300  # seconds

agent:
  max_tool_iterations: 5
  system_prompt: |
    You are BlipShell, a helpful local AI assistant with persistent memory.
    You remember previous conversations and learn from interactions.
    Be concise and helpful. Use your memory to provide personalized assistance.

    IMPORTANT: You have tools available. Use them when appropriate:
    - web_search: Look up current information or answer factual questions.
    - web_fetch: Read the contents of a specific URL.
    - read_file, write_file, list_directory: File operations.
    - run_command: Execute shell commands.
    - save_core_memory: Permanently remember important facts about the user.
    - promote_to_core_memory: Promote an important memory or lesson to permanent core memory.
    - start_background_task: Offload long-running work to run in the background.

    MEMORY IS AUTOMATIC: Past conversations and lessons are automatically searched and loaded into your context. Do NOT call search_memories unless the user explicitly asks you to search for a specific past conversation. It is already done for you.

    When a user asks you to search or you need current information, ALWAYS call web_search. Do not say you cannot search - use the tool.
  stream: true

tools:
  shell:
    timeout: 30
    allowed_commands:
      - "ls"
      - "dir"
      - "cat"
      - "type"
      - "echo"
      - "pwd"
      - "cd"
      - "find"
      - "grep"
      - "head"
      - "tail"
      - "wc"
      - "sort"
      - "python"
      - "pip"
      - "git"
      - "node"
      - "npm"
      - "cargo"
      - "make"
      - "cmake"
  filesystem:
    max_file_size: 1048576  # 1MB
    blocked_paths:
      - "/etc/shadow"
      - "/etc/passwd"
  web:
    max_fetch_size: 524288  # 512KB
    timeout: 15

noise:
  min_word_count: 3
  max_filler_ratio: 0.6

tagging:
  max_tags: 7

llm:
  max_retries: 2
  retry_base_delay: 1.0

auth:
  enabled: false
  api_key: ""

database:
  path: "data/blipshell.db"
  chroma_path: "data/chroma"

web_ui:
  host: "0.0.0.0"
  port: 8000

planner:
  enabled: false           # Auto-detection off — use !plan to trigger manually
  auto_approve: true      # Plans execute immediately (no review step)
  max_steps: 7            # Maximum steps per plan
  max_retries_per_step: 2 # Retries before marking step as failed
  complexity_threshold_words: 20  # Word count threshold for planning

worker:
  enabled: false                     # Enable remote worker routing
  default_remote_endpoint: ""        # Name of default remote endpoint
  task_types_for_remote:             # Task types auto-routed to remote
    - "summarization"
    - "research"
    - "analysis"
  poll_interval: 10                  # Seconds between worker polls
